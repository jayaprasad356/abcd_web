SELECT SUM(withdrawals.amount) FROM `users`,`withdrawals` WHERE users.id = withdrawals.user_id AND users.joined_date < DATE_SUB( '2023-03-15', INTERVAL 58 DAY) AND withdrawals.status = 0 AND DATE(withdrawals.datetime) = '2023-03-15'


INSERT INTO join_reports (date, total_users)
SELECT joined_date, COUNT(id) AS total_users
FROM users
WHERE status = 1
GROUP BY joined_date
ORDER BY joined_date;


UPDATE join_reports
SET total_paid = (
  SELECT SUM(amount)
  FROM withdrawals
  WHERE status = 1 AND DATE(datetime) = join_reports.date
  GROUP BY DATE(datetime)
)
WHERE EXISTS (
  SELECT 1
  FROM withdrawals
  WHERE status = 1 AND DATE(datetime) = join_reports.date
);